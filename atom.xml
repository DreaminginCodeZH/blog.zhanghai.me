<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[梦断代码]]></title>
  <subtitle><![CDATA[乐天知命]]></subtitle>
  <link href="http://blog.zhanghai.me/atom.xml" rel="self"/>
  <link href="http://blog.zhanghai.me"/>
  <updated>2014-11-18T07:48:06.624Z</updated>
  <id>http://blog.zhanghai.me/</id>
  <author>
    <name><![CDATA[张海]]></name>
  </author>
  <generator uri="http://zespia.tw/hexo">Hexo</generator>
  <entry>
    <title type="html"><![CDATA[Arch Linux Notes]]></title>
    <link href="http://blog.zhanghai.me/arch-linux-notes/"/>
    <id>http://blog.zhanghai.me/arch-linux-notes/</id>
    <published>2014-11-03T06:18:11.000Z</published>
    <updated>2014-11-18T07:47:24.000Z</updated>
    <content type="html"><![CDATA[<p>This is my notebook for some small tips and tricks when using Arch Linux.</p>
<h2 id="Why_Arch_Linux?">Why Arch Linux?</h2>
<ul>
<li><p>It is fresh and simple in package dependency.</p>
</li>
<li><p>It has an powerful Arch User Repository and makes it easy for you to make/modify your package.</p>
</li>
<li><p>It has an detailed Arch Wiki comprising useful experiences and recommendations.</p>
</li>
<li><p>It gets you to learn the basic knowledge required to be a Linux user/administrator/programmer.</p>
</li>
</ul>
<a id="more"></a>

<h2 id="NTFS_partitions_auto_mounting">NTFS partitions auto mounting</h2>
<ol>
<li><p>Use <code>gnome-disks</code>, select partition and click the settings button below, click and then modify mount options in the popup menu.</p>
</li>
<li><p>Install <code>ntfs-config</code> and enable auto mounting.</p>
</li>
</ol>
<h2 id="DNS_and_resolvconf">DNS and resolvconf</h2>
<p>DNS is managed by <code>resolvconf</code> in Arch Linux. In order to supply your own DNS, edit <code>/etc/resolvconf.conf</code>.</p>
<p>There are two options you may normally want to specify:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="setting">name_servers=<span class="value">&lt;DNS1&gt; #Prepended into DNS list</span></span></div><div class="line"><span class="setting">name_servers_append=<span class="value"><span class="string">"&lt;DNS2&gt; &lt;DNS3&gt; ..."</span></span></span></div></pre></td></tr></table></figure>

<p>After modification, you may want to execute <code>resolvconf -u</code> to update <code>resolv.conf</code>.</p>
<p>Note that <code>dhcpd</code> also setup DNS for interfaces via <code>resolvconf</code>, in <code>/run/resolvconf/interface/&lt;INTERFACE&gt;</code>. You can override its behavior by executing <code>dhcpcd -S domain_name_servers=&lt;DNS&gt;</code>, or inside <code>dhcpcd.conf</code>.</p>
<h2 id="Create_software_AP_(Access_Point),_a-k-a-_virtual_WiFi">Create software AP (Access Point), a.k.a. virtual WiFi</h2>
<p>Install AUR package <code>create_ap</code>; you may want to remove the <code>wifi.service</code> it automatically creates when installed and use your own.</p>
<p>Check the Capabilities section in <code>iw list</code> along with <code>/usr/share/doc/hostapd/hostapd.conf</code> to determine <code>ht_capab</code>.</p>
<p>Note that in ZJU, ZJUWLAN occupies channel 1 and 6, so you’d better specify another channel.</p>
<p>Sample systemd service:</p>
<p>File: <code>&lt;YOUR_SSID&gt;@.service</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="title">[Unit]</span></div><div class="line"><span class="setting">Description=<span class="value">Create AP service for &lt;YOUR_SSID&gt;</span></span></div><div class="line"><span class="setting">After=<span class="value">network.target</span></span></div><div class="line"></div><div class="line"><span class="title">[Service]</span></div><div class="line"><span class="setting">Type=<span class="value">simple</span></span></div><div class="line"><span class="setting">ExecStart=<span class="value">/usr/bin/create_ap -c <span class="number">13</span> -w <span class="number">2</span> -m nat --ieee80211n --ht_capab [HT40-][HT40+][SMPS-STATIC][GF][SHORT-GI-<span class="number">20</span>][SHORT-GI-<span class="number">40</span>][DSSS_CCK-<span class="number">40</span>] &lt;YOUR_WLAN_INTERFACE&gt; %i &lt;YOUR_SSID&gt; &lt;YOUR_PASSPHRASE&gt;</span></span></div><div class="line"><span class="setting">ExecStop=<span class="value">pkill hostapd</span></span></div><div class="line"><span class="setting">KillSignal=<span class="value">SIGINT</span></span></div><div class="line"><span class="setting">Restart=<span class="value"><span class="keyword">on</span>-failure</span></span></div><div class="line"><span class="setting">RestartSec=<span class="value"><span class="number">5</span></span></span></div><div class="line"></div><div class="line"><span class="title">[Install]</span></div><div class="line"><span class="setting">WantedBy=<span class="value">multi-user.target</span></span></div></pre></td></tr></table></figure>

<p>However on my own machine, I cannot share a secure (with password) network.</p>
<h2 id="Raise_inotify_limit_for_IntelliJ_IDEA">Raise inotify limit for IntelliJ IDEA</h2>
<p>Write the following line to <code>/etc/sysctl.d/99-sysctl.conf</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fs.inotify.max_user_watches = 524288</div></pre></td></tr></table></figure>

<h2 id="Sysrq">Sysrq</h2>
<p>Write the following line to <code>/etc/sysctl.d/99-sysctl.conf</code> to enable all the sysrq operations.</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kernel.sysrq = 1</div></pre></td></tr></table></figure>

<p>Reboot to make changes take effect, or execute <code>echo 1 &gt;/proc/sys/kernel/sysrq</code>.</p>
<p>Hold <code>Alt</code>, and press the following key sequence.</p>
<ol>
<li><code>SysRq</code></li>
<li><code>R</code>    unRaw</li>
<li><code>E</code>    tErminate</li>
<li><code>I</code>    kIll</li>
<li><code>S</code>    Sync</li>
<li><code>U</code>    Unmount</li>
<li><code>B</code>    reBoot</li>
</ol>
<p>Note that the key <code>C</code> can make your kernel panic immediately.</p>
<h2 id="Map_Alt_Gr_(Right_Alt)_to_Alt_in_tty">Map Alt Gr (Right Alt) to Alt in tty</h2>
<p>From <a href="https://wiki.archlinux.org/index.php/Keyboard_Configuration_in_Console_%28%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87%29" target="_blank" rel="external">Arch Wiki</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/share/kbd/keymaps/i386/qwerty</div><div class="line">cp us.map.gz us-two-alt-keys.map.gz</div><div class="line">gunzip us-two-alt-keys.map.gz</div></pre></td></tr></table></figure>

<p>Edit <code>us-two-alt-keys.map</code>，replace <code>include &quot;linux-with-alt-and-altgr&quot;</code> with <code>include &quot;linux-with-two-alt-keys&quot;</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gzip us-two-alt-keys.map</div></pre></td></tr></table></figure>

<p>Edit <code>/etc/vconsole.conf</code>, replace <code>KEYMAP=us</code> with <code>KEYMAP=us-two-alt-keys</code>.</p>
<p>Reboot.</p>
<h2 id="Make_programs_use_proxy">Make programs use proxy</h2>
<p>There are several ways to make a program proxied. Part of the following comes from <a href="https://wiki.archlinux.org/index.php/proxy_settings" target="_blank" rel="external">Arch Wiki</a>.</p>
<ul>
<li><p>Environment variables</p>
<p>  Some programs respect proxy set via environment variables.</p>
<p>  <!-- Unable to wrap a backtick code block in a list item. --></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> http_proxy=http://<span class="number">10.203</span>.<span class="number">0.1</span>:<span class="number">5187</span>/</div><div class="line"><span class="keyword">export</span> https_proxy=<span class="variable">$http_proxy</span></div><div class="line"><span class="keyword">export</span> ftp_proxy=<span class="variable">$http_proxy</span></div><div class="line"><span class="keyword">export</span> rsync_proxy=<span class="variable">$http_proxy</span></div><div class="line"><span class="keyword">export</span> no_proxy=<span class="string">"localhost,127.0.0.1,localaddress,.localdomain.com"</span></div></pre></td></tr></table></figure>

<p>  It is sometimes advised that you export these environment variables again, with their names upper cased.</p>
</li>
<li><p>Proxychains</p>
<p>  Install <a href="https://www.archlinux.org/packages/?name=proxychains-ng" target="_blank" rel="external">proxychains-ng</a>. Proxychains hooks some C library functions so that programs gets proxied. However the Java VM cannot be proxied this way.</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">proxychains &lt;YOUR_PROGRAM&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>Java</p>
<p>  From <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/net/proxies.html" target="_blank" rel="external">the documentation of Java</a>:</p>
<ul>
<li><p>HTTP</p>
<ul>
<li><p>http.proxyHost: the host name of the proxy server</p>
</li>
<li><p>http.proxyPort: the port number, the default value being 80.</p>
</li>
<li><p>http.nonProxyHosts: a list of hosts that should be reached directly, bypassing the proxy. This is a list of patterns separated by ‘|’. The patterns may start or end with a ‘*’ for wildcards. Any host matching one of these patterns will be reached through a direct connection instead of through a proxy.</p>
</li>
</ul>
</li>
<li><p>HTTPS</p>
<ul>
<li><p>https.proxyHost</p>
<p>https.proxyPort</p>
</li>
</ul>
</li>
<li><p>FTP</p>
<ul>
<li><p>ftp.proxyHost (Typo in official documentation)</p>
</li>
<li><p>ftp.proxyPort</p>
</li>
<li><p>ftp.nonProxyHosts</p>
</li>
</ul>
</li>
<li><p>SOCKS</p>
<ul>
<li><p>socksProxyHost for the host name of the SOCKS proxy server</p>
</li>
<li><p>socksProxyPort for the port number, the default value being 1080</p>
</li>
</ul>
<p>Sample usage:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -Dhttp.proxyHost=webcache.example.com -Dhttp.proxyPort=<span class="number">8080</span> -Dhttp.nonProxyHosts=”localhost|host.example.com”</div></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<p>Note that you can tunnel http(s) request to local socks client using <a href="https://www.archlinux.org/packages/?name=delegate" target="_blank" rel="external">DeleGate</a>.</p>
<h2 id="Install_font">Install font</h2>
<p>From <a href="https://wiki.archlinux.org/index.php/Fonts" target="_blank" rel="external">Arch Wiki</a>:</p>
<p>Drop your font files into <code>~/.fonts/</code>, <code>cd</code> into that directory, and execute the following command.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> -n <span class="string">"Updating font cache... "</span></div><div class="line">fc-cache &gt;/dev/null <span class="operator">-f</span></div><div class="line">mkfontscale</div><div class="line">mkfontdir</div><div class="line"><span class="built_in">echo</span> <span class="keyword">done</span></div></pre></td></tr></table></figure>

<h2 id="Analyze_boot_time">Analyze boot time</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemd-analyze blame</div></pre></td></tr></table></figure>

<p>Sometimes man-db.service might slow down the booting drastically, see <a href="https://bbs.archlinux.org/viewtopic.php?pid=1409295" target="_blank" rel="external">this thread</a>, <a href="https://bugs.archlinux.org/task/41511" target="_blank" rel="external">this issue</a>, and <a href="https://bugs.archlinux.org/task/41688" target="_blank" rel="external">this issue</a>.</p>
<h2 id="System_backup_using_tar">System backup using tar</h2>
<p>Install AUR package <code>system-tar-and-restore</code>.</p>
<p>Example: <code>/etc/backup.conf</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"># Configuration file for backup.sh script.</div><div class="line"># Place it in /etc/backup.conf and edit it to your needs.</div><div class="line"></div><div class="line"></div><div class="line"># Set the interface. Available options: cli dialog.</div><div class="line">BRinterface="cli"</div><div class="line"></div><div class="line"># Uncomment to disable colors.</div><div class="line">#BRnocolor="Yes"</div><div class="line"></div><div class="line"># Uncomment to enable verbose archiver output.</div><div class="line">#BRverb="Yes"</div><div class="line"></div><div class="line"># Set the destination directory. Default is /.</div><div class="line">BRFOLDER="/run/media/zh/ZH-HDD/"</div><div class="line"></div><div class="line"># Uncomment to set alternative archive name. Default is 'Backup-$(hostname)-$(date +%d-%m-%Y-%T)'.</div><div class="line">#BRNAME="my_backup"</div><div class="line"></div><div class="line"># Set the archiver. Available options: tar bsdtar.</div><div class="line">BRarchiver="tar"</div><div class="line"></div><div class="line"># Set the compressor. Available options: gzip bzip2 xz none.</div><div class="line">BRcompression="gzip"</div><div class="line"></div><div class="line"># Uncomment to keep /home's hidden files and folders only.</div><div class="line">#BRhome="No"</div><div class="line"></div><div class="line"># Uncomment to completely exclude /home directory. Use with BRhome="No".</div><div class="line">#BRhidden="No"</div><div class="line"></div><div class="line"># Uncomment to set additional archiver options.</div><div class="line">BR_USER_OPTS="--exclude=/var/cache/* --exclude=/home/zh/.cache/* --acls --xattrs"</div><div class="line"></div><div class="line"># Uncomment to disable genkernel check in gentoo.</div><div class="line">#BRgenkernel="No"</div><div class="line"></div><div class="line"># Uncomment to be quiet.</div><div class="line">#BRquiet="Yes"</div></pre></td></tr></table></figure>

<p>To start a backup, execute <code>backup.sh</code> as root.</p>
<h2 id="Rename_files_with_number">Rename files with number</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">find -name <span class="string">'*.png'</span> | sort -n -r | gawk <span class="string">'{ printf "mv %s %03d.png\n", $0, NR }'</span> | bash</div></pre></td></tr></table></figure>

<p>100 files, reversely:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">find -name <span class="string">'*.png'</span> | sort -n -r | gawk <span class="string">'{ printf "mv %s %03d.png\n", $0, 100 - NR }'</span> | bash</div></pre></td></tr></table></figure>

<p>Starting with 100:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">find -name <span class="string">'*.png'</span> | sort -n -r | gawk <span class="string">'{ printf "mv %s %03d.png\n", $0, 100 + NR }'</span> | bash</div></pre></td></tr></table></figure>

<h2 id="GNOME_3_Start_up_applications">GNOME 3 Start up applications</h2>
<p>As of GNOME 3.12, <code>gnome-session-properties</code> is removed. Instead, launch <code>gnome-tweak-tool</code> and go to the corresponding tab. If you cannot add a start up application (the add button not responding), try launching <code>gnome-tweak-tool</code> from your terminal.</p>
<p>To truly manage your start up applications, go to <code>~/.config/autostart/</code> and edit the desktop files there.</p>
<h2 id="Pomodoro_for_GNOME_3">Pomodoro for GNOME 3</h2>
<p>Install AUR package <code>gnome-shell-pomodoro</code>.</p>
<h2 id="Clipboard_management_tool_for_GNOME_3">Clipboard management tool for GNOME 3</h2>
<p>Install AUR package <code>gpaste</code>, restart GNOME shell and enable the extension GPaste.</p>
<h2 id="Convert_video_to_animated_GIF">Convert video to animated GIF</h2>
<p>Adapted From <a href="http://dtbaker.net/random-linux-posts/convert-video-avi-mpeg-mp4-to-a-gif-animation-on-linux/" target="_blank" rel="external">dtbaker</a> and <a href="http://superuser.com/questions/556029/how-do-i-convert-a-video-to-gif-using-ffmpeg-with-reasonable-quality/556031" target="_blank" rel="external">a SuperUser question</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir frames</div><div class="line">ffmpeg -ss &lt;HH:MM:SS[.XXX]|START_SECONDS&gt; -t&lt;HH:MM:SS[.XXX]|DURATION_SECONDS&gt; -i &lt;YOUR_VIDEO_FILE&gt; [-r &lt;FPS&gt;] <span class="operator">-s</span> &lt;WIDTH_NORMALLY_480&gt;x&lt;HEIGHT_NORMALLY_270&gt; ./frames/frame%<span class="number">04</span>d.png</div><div class="line">convert -delay &lt;<span class="number">100</span>/FPS&gt; -loop <span class="number">0</span> -layers Optimize ./frames/frame*.png output.gif</div></pre></td></tr></table></figure>

<p>If you need to compress your GIF file, use <code>gifsicle</code> or do it <a href="http://ezgif.com/optimize" target="_blank" rel="external">online</a>; for cropping, you also can use <a href="http://ezgif.com/crop" target="_blank" rel="external">this site</a> with option “Crop with Gifsicle” (ImageMagick output seems corrupted).</p>
<h2 id="Convert_GB*_encoded_mp3_tag_to_Unicode">Convert GB* encoded mp3 tag to Unicode</h2>
<p>Install package <code>easytag</code>.</p>
<p>Note that EasyTag may become the handler for MIME type <code>inode/directory</code>, instead of your own file manager, say, Nautilus. You can delete the default association for Easytag and inode/directory in <code>~/.local/share/applications/mimeapps.list</code>, which is managed by <code>gvfs-mime</code>. See also the MIME type section.</p>
<h2 id="MIME_type_handling">MIME type handling</h2>
<p>In GNOME, there are two components managing the default application for a MIME type.</p>
<p>The first one, which is system-wide, can be queried or set via <code>xdg-mime</code>.</p>
<p>The second one, which is a per-user setting, can be queried or set via <code>gvfs-mime</code>, or manually editing <code>~/.local/share/applications/mimeapps.list</code>.</p>
<p>The second one takes precedence, and I guess <code>gvfs-mime</code> is implemented partially for GNOME Open with dialog.</p>
<h2 id="Google_URL_in_Google_Chrome">Google URL in Google Chrome</h2>
<p>Open <code>~/.config/google-chrome/Default/Preferences</code>, edit <code>last_known_google_url</code> and <code>last_prompted_google_url</code>.</p>
<h2 id="Draw_graphs">Draw graphs</h2>
<p>LibreOffice Draw, and use its connectors instead of bare wires. Shift for normal shaping and Ctrl + Mouse move for cloning can also be handy.</p>
<h2 id="Render_GFM">Render GFM</h2>
<p>Bash script from <a href="https://gist.github.com/jaburns/33d88f4aa99bb4ab6ad6" target="_blank" rel="external">jaburn’s gist</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="shebang">#!/usr/bin/env bash</span></div><div class="line"></div><div class="line">data=<span class="string">"<span class="variable">$(</span></span></div><div class="line">    cat "$1" \</div><div class="line">      | sed 's/"/\\"/g' \</div><div class="line">      | sed ':a;N;$!ba;s/\n/\\n/g' \</div><div class="line">)"</div><div class="line"></div><div class="line"><span class="keyword">if</span> [[ -z <span class="string">"<span class="variable">$2</span>"</span> ]]; <span class="keyword">then</span></div><div class="line">    context=<span class="string">''</span></div><div class="line"><span class="keyword">else</span></div><div class="line">    context=<span class="string">",\"context\":\"<span class="variable">$2</span>\""</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">'&lt;!DOCTYPE html&gt;'</span></div><div class="line"><span class="built_in">echo</span> <span class="string">'&lt;html&gt;&lt;head&gt;&lt;style&gt;'</span></div><div class="line">curl <span class="operator">-s</span> <span class="string">'https://gist.githubusercontent.com/andyferra/2554919/raw/2e66cabdafe1c9a7f354aa2ebf5bc38265e638e5/github.css'</span></div><div class="line"><span class="built_in">echo</span> <span class="string">'&lt;/style&gt;&lt;/head&gt;&lt;body&gt;'</span></div><div class="line">curl <span class="operator">-s</span> --data <span class="string">"{\"text\":\"<span class="variable">$data</span>\",\"mode\":\"gfm\"<span class="variable">$context</span>}"</span> <span class="string">'https://api.github.com/markdown'</span></div><div class="line"><span class="built_in">echo</span> <span class="string">'&lt;/body&gt;&lt;/html&gt;'</span></div></pre></td></tr></table></figure>

]]></content>
    <category scheme="http://blog.zhanghai.me/categories/software/" term="Software"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[Android 设计简明教程]]></title>
    <link href="http://blog.zhanghai.me/android-design-guide/"/>
    <id>http://blog.zhanghai.me/android-design-guide/</id>
    <published>2014-11-02T10:23:15.000Z</published>
    <updated>2014-11-07T13:36:33.000Z</updated>
    <content type="html"><![CDATA[<p><img src="/android-design-guide/android_design_elements_landing.png" alt="欢迎"></p>
<h2 id="零、前言">零、前言</h2>
<p>这是我作为一名 Android 开发者对 Android 设计的理解。在这个教程中，我主要参考<a href="http://developer.android.com/design/index.html" target="_blank" rel="external">官方的设计教程</a>，同时会加入一些自己的见解，并穿插一些实用资源。其中 <a href="http://www.geekpark.net/users/163712/topics" target="_blank" rel="external">NovaDNG</a> 的几篇文章对我影响较大，对此十分感谢。</p>
<p>在今年，Google 已经推出了新的 <a href="https://www.google.com/design/spec/material-design/introduction.html" target="_blank" rel="external">Material 设计标准</a>，对真实世界进行抽象的模拟，实现了在各个平台上的统一设计标准。我对这个标准的理念认同，然而在布局等细节上有些许分歧。诸位可以学习完 Android 设计后继续学习 Material 设计，作出自己的判断。</p>
<a id="more"></a>

<h2 id="一、设计原则">一、<a href="http://developer.android.com/design/get-started/principles.html" target="_blank" rel="external">设计原则</a></h2>
<p>为了对设计中的问题解决提供指导，设计师结合他们所追求的设计理念和实际的设计案例，制定了一系列的设计原则。</p>
<p>在学习 Android 设计的过程中，首先接触 Android 官方推荐的设计原则，可以在设计过程的初期就逐渐熟悉并得到运用。在这以后，经过长期的观察与设计，大家也可以渐渐总结出自己的设计原则。总而言之，有所坚持，有所变通。</p>
<p>以下是一些官方设计原则页面上提及的设计规范，但按照我个人的设计理念，重新进行了组织。</p>
<ol>
<li><p>一致</p>
<p> 一致性是众多原则所共同要求的特性。一致性符合人的认知习惯，无论是编程还是设计，一致性都能够带来清晰与优雅。</p>
<ul>
<li><p>保持应用界面的一致性。相似的内容应当拥有相似的布局，使得用户得以通过经验快速熟悉应用。</p>
</li>
<li><p>保持应用逻辑的一致性。相似的界面元素应当拥有相似的功能，使得用户能够举一反三，至于熟练。</p>
<p>  <img src="/android-design-guide/android_principles_looks_same.png" alt="一致的 ActionBar Spinner 导航"></p>
<p>  如上图 ActionBar 中的导航，都是通过点击 Spinner（下拉列表框）来更改主界面正在浏览内容的分类。</p>
</li>
<li><p>保持与 Android 界面的一致性。其他平台（如 iOS）拥有自己的设计风格，但 Android 也有着自己的视觉语言，即拟物。Android 用户在应用中期待的是和平台一致的用户界面，因此，请不要将其他平台的设计元素强行引入，相反，寻找并使用 Android 的表现方式。所谓入乡随俗。</p>
<p>  <img src="/android-design-guide/holo_everywhere.png" alt="Holo 主题中的控件"></p>
<p>  以上是 Holo 主题中的一些控件的展示，可以注意到整体设计风格与 iOS 的不同。这在之后会继续讨论。</p>
</li>
</ul>
</li>
<li><p>简约</p>
<p> 简约不是简陋，而是合适简化与强大功能的结合。</p>
<ul>
<li><p>使用拟真的界面元素，经过适当的抽象在实物与概念化间达到平衡，从而给用户以熟悉而优雅的体验。</p>
<p>  <img src="/android-design-guide/android_principles_real_objects.png" alt="通过拟真的交互方式将图标分组"></p>
<p>  拟真是 Android 的核心设计理念，这在之后的 Android 风格介绍中会进行说明。</p>
</li>
<li><p>简化界面的布局，突出常用的功能，而将不常用者隐藏于菜单等二级界面，降低用户的认知负担，加快学习进程。</p>
<p>  <img src="/android-design-guide/android_principles_information_when_need_it.png" alt="将功能装入 Action Overflow"></p>
</li>
<li><p>适当而不过度的界面动画，可以为操作过程增加趣味，同时间接说明界面间的逻辑关系。</p>
<p>  <img src="/android-design-guide/android_principles_delight.png" alt="启动器（主屏幕）翻页到达边缘的动画"></p>
</li>
</ul>
</li>
<li><p>友好</p>
<ul>
<li><p>让用户能够自定义应用，同时记住用户的偏好，让用户拥有在应用中的归属感。</p>
</li>
<li><p>为用户作出最佳的决定，但总是让用户最终确认。</p>
<p>  <img src="/android-design-guide/android_principles_decide_for_me.png" alt="自动打开 Beam"></p>
<p>  用户是为了方便生活而使用应用，因此，应用应当尽力简化用户的操作，根据当前的状态，提供最合理的默认值。同时，为了不让用户感到惊讶或受到侵犯，在执行决定之前总是征求他们的同意。</p>
</li>
<li><p>只在必要时提醒用户，避免打扰。</p>
<p>  <img src="/android-design-guide/android_principles_important_interruption.png" alt="日历在事件即将开始时的提醒是可以接受的"></p>
<p>  Android 中的通知栏是经常被国产应用滥用的地方，常常可以见到许多广告或是不需要的信息被应用探出在此。我自己，以及一批用户对此都深恶痛绝。</p>
<p>  通知栏中仅仅应当出现用户自己设定的内容，或者是真正具有足够重要性的内容。并且即便如此，还是应当尽量减少应用弹出的通知，避免对用户的打扰。</p>
</li>
<li><p>友好地提示用户的错误，隐藏技术细节，突出重要信息，提供易于操作的解决方案。</p>
<p>  <img src="/android-design-guide/android_principles_keep_it_brief.png" alt="简洁明了的提示文本"></p>
<p>  <img src="/android-design-guide/android_principles_error.png" alt="清晰详细的操作指示"></p>
</li>
<li><p>给予用户操作及时的反馈，让用户放心，并获得成就感。</p>
<p>  <img src="/android-design-guide/android_confirm_ack_acknowledge.png" alt="日历应用创建事件后的提醒"></p>
<p>  例如在修改成功后使用 Toast 提示，以及使用向导而非直接让用户填写长表单。关于进行提醒反馈的时机将会在之后进行详细讨论。</p>
</li>
</ul>
</li>
</ol>
<p>以上设计原则中，有很多与用户体验相关，因为设计的目标之一即是对用户友好。下面是一篇来源于 Android 官方视频的文章，可供参考。</p>
<blockquote>
<p>延伸阅读：<br><a href="http://www.geekpark.net/topics/188876" target="_blank" rel="external">Android 应用中十大常见 UX 错误</a></p>
</blockquote>
<h2 id="二、设计样式">二、设计样式</h2>
<h3 id="风格">风格</h3>
<p>可以先来谈谈其他平台的设计风格。iOS 历史版本的设计风格是拟物，即尝试将实际物体的形状、材质，都在图像资源中体现，来为用户提供友好而熟悉的体验。而当前版本的  iOS 及 Windows Phone 当前的设计风格是扁平化的。其设计的目的是使用大量的纯色与矩形，减少界面元素装饰对用户精力的分散，突出交互元素的内容。</p>
<p>Android 的设计风格可以称之为拟真。拟真与拟物相似，但又并非拟物。拟真是对显示中物体的部分抽象，即保留人们熟悉的物体外形，而去除物体的具体材质，同时加上柔和的阴影。通过拟真的设计，可以避免由于完全拟物带来的认知过载，同时防止过于抽象带来的认知困难，这就是 Android 的设计风格。</p>
<p>顺便一提，在 Android 的设计中，一般建议阴影是从前上方 45 度角照明产生的，这在启动器图标和卡片等界面元素的设计中都有体现。</p>
<p><img src="/android-design-guide/android_iconography_launcher_example2.png" alt="Android 拟真风格的图标"></p>
<h3 id="主题"><a href="http://developer.android.com/design/style/themes.html" target="_blank" rel="external">主题</a></h3>
<p>Android 4 原生主题的名称为 Holo，具有暗色和亮色两个风格，以及一个暗色 ActionBar，亮色界面的变种风格。通过使用原生的主题，可以让应用程序快速获得与 Android 匹配的视觉体验。</p>
<p><img src="/android-design-guide/android_themes_holo_light.png" alt="Holo Light"></p>
<p><img src="/android-design-guide/android_themes_holo_dark.png" alt="Holo (Dark)"></p>
<p>将原生主题使用自己的配色进行修改，使得应用同时具有自己的特色，也是一种常见的方案。修改主题的任务较为繁琐，所幸可以使用 <a href="http://romannurik.github.io/AndroidAssetStudio/" target="_blank" rel="external">Android Asset Studio</a> 这个第三方工具进行主题的生成。</p>
<p><img src="/android-design-guide/android_asset_studio.png" alt="Android Asset Studio"></p>
<p>Android Asset Studio 可以进行图标和主题等资源的生成，极大地简化设计的实现过程。</p>
<p>在此之外，虽然 Holo 主题是 Android 设计的代表性元素，但也并不是 Android 设计的全部。具体的探讨，可以参考以下这篇文章。</p>
<blockquote>
<p>延伸阅读：<br><a href="http://www.geekpark.net/topics/179488" target="_blank" rel="external">Android Design 与 Holo Theme</a></p>
</blockquote>
<h3 id="度量"><a href="http://developer.android.com/design/style/metrics-grids.html" target="_blank" rel="external">度量</a></h3>
<blockquote>
<p>提示：<br>这一小节部分内容与 Android 中应用程序的具体实现有所关联，设计者在初期仅需了解即可。</p>
</blockquote>
<p>Android 的设备规格是碎片化的，因此 Android 也有专门设计的方式应对。</p>
<p>设备使用 DPI（Dots per Inch，每英寸像素数）表示屏幕像素密度，从而在不同清晰度的设备上呈现相通的物理大小。</p>
<p>相应地，在进行设计时，也有不同的单位可以选择。</p>
<ol>
<li><p>px（Pixel，像素）（少用）</p>
<p> px 是图像中最基本的单位，在显示器上固定显示为一个点的大小。因此，当屏幕上的像素密度不一致时，显示在屏幕上的实际物理大小则会过大或过小。</p>
</li>
<li><p>dp（Density-independent Pixel，曾写作 dip，密度独立像素）（用于图像）</p>
<p> Android 设计中通常以 dp 作为图像的尺寸单位，使得同一素材在不同设备屏幕上的大小等表现能够一致。</p>
</li>
<li><p>sp（Scale-independent Pixel，缩放独立像素）（用于文本）</p>
<p> Android 中允许用户自定义字体的缩放级别，所以产生了 sp 。当应用使用 sp 作为文本单位时，文本大小就可以跟随用户的文本缩放级别自动改变大小，因此 Android 中推荐所有文本的大小都使用 sp 作为单位指定。在默认缩放尺寸（1x）下，1sp 等于 1dp。</p>
</li>
</ol>
<p>为了实现密度独立，需要为不同 DPI 的设备适配不同大小的位图资源。如果仅仅对高质量的图像资源进行缩放，可能会导致图像的失真（例如边缘处）。</p>
<p>因此，Android 将不同的屏幕像素密度按照大小划分到了几个不同的分类（Bucket，桶）中。随着设备的更新，DPI 的分类也缓慢地随之增多。这些分类目前包括 LDPI（Low，一般已不再支持），MDPI（Medium），HDPI（High），XHDPI（eXtra High），XXHDPI（eXtra-eXtra High）（及 XXXHDPI，仅用于应用图标）。</p>
<p><img src="/android-design-guide/android_metrics_diagram.png" alt="Android 设备的屏幕尺寸"></p>
<p>开发者为每个分类提供相应大小的图像资源，在分类内部不同的像素密度之内则由 Android 操作系统自动进行缩放，如此就完成了对不同屏幕密度的适配。</p>
<p>这项工作较为繁琐，不过之前提到的 <a href="http://romannurik.github.io/AndroidAssetStudio/" target="_blank" rel="external">Android Asset Studio</a> 中也提供了上传高品质的图像，自动使用二次立方插值算法（较为平滑，但比线性缩放耗时稍多）进行缩放生成不同 DPI 所需图片，并按目录组织打包以供下载的功能。</p>
<h3 id="排版"><a href="http://developer.android.com/design/style/metrics-grids.html#48dp-rhythm" target="_blank" rel="external">排版</a></h3>
<p>Android 应用的界面普遍以 48dp 组织一个视觉单位，例如 ActionBar 的高度、列表的行高、文本框和按钮的高度。48dp 在物理设备上大约为 9mm 的长度，正好处于 7-10mm 的舒适触摸区域大小之内，同时可以在设备屏幕上保证合理的信息密度，更为重要的是，一致的元素高度可以让用户界面简约而优雅。</p>
<p><img src="/android-design-guide/android_metrics_forms.png" alt="48dp 旋律"></p>
<p>这称为 Android 的 48dp 韵律。</p>
<p>而 Android 中部件的间距常常为 8dp。这个边距常常被原生部件已经计算在内，然而有时也需要自己指定。</p>
<p><img src="/android-design-guide/android_metrics_closeup.png" alt="部件的布局"></p>
<p>可以看出，Android 中布局常常是以 4dp 的倍数作为长度，这也是推荐的实践。</p>
<h3 id="文字样式"><a href="http://developer.android.com/design/style/typography.html" target="_blank" rel="external">文字样式</a></h3>
<h4 id="字体">字体</h4>
<p><img src="/android-design-guide/android_typography_main.png" alt="英文字体排版"></p>
<p>Android 4.0 之后默认的英文无衬线字体 Roboto 已经具有多个变种，因此英文中也常常使用不同的字体来实现美观的排版。</p>
<p><img src="/android-design-guide/android_typography_variants@2x.png" alt="Roboto 字体集"></p>
<blockquote>
<p>下载：<br><a href="http://developer.android.com/downloads/design/roboto-1.2.zip" target="_blank" rel="external">Roboto 字体集</a></p>
</blockquote>
<p>Android 中的中文字体名为 Droid Sans Fallback，顾名思义，只是一个回退的字体，虽然作为无衬线字体在移动端小型屏幕上拥有令人满意的视觉体验，但并没有如同英文字体那样多的风格与设计考虑。因此，中文常用的字体样式只有常规和粗体两种（中文斜体由算法生成，样式并不理想）。</p>
<h4 id="字号">字号</h4>
<p>字号的变化可以产生对比，但过多的字号会导致界面的混乱。Android 系统提供了以下几种推荐的字号。</p>
<p><img src="/android-design-guide/android_typography_sizes.png" alt="Android 系统字号"></p>
<h4 id="文字颜色">文字颜色</h4>
<p>Android 的 Holo 主题默认定义了多种字体颜色，在设计时也可以进行引用。</p>
<p><img src="/android-design-guide/android_typography_defaults.png" alt="Holo 主题文字颜色"></p>
<h3 id="色彩"><a href="http://developer.android.com/design/style/color.html" target="_blank" rel="external">色彩</a></h3>
<p>Android 拥有自己的标准调色盘（Palette），包括深浅两个风格的红、黄、绿、紫、蓝五色。</p>
<p><img src="/android-design-guide/android_color_palette.png" alt="Android 调色盘"></p>
<blockquote>
<p>下载<br><a href="http://developer.android.com/downloads/design/Android_Design_Color_Swatches_20120229.zip" target="_blank" rel="external">Android 调色盘</a></p>
</blockquote>
<p>在设计应用界面时，使用系统调色盘的颜色可以简化颜色挑选，同时获得与平台的一致性。</p>
<p>顺带一提，关于灰色，Android 制定了为人类视觉优化的两种灰色标准（猜测与人眼 Gamma 有关）。</p>
<ol>
<li><p>在亮色主题中，RGB 色彩为 #333333，不透明度为启用时 60%，禁用时 30%。</p>
</li>
<li><p>在暗色主题中，RGB 色彩为 #FFFFFF，不透明度为启用时 80%，禁用时 30%。</p>
</li>
</ol>
]]></content>
    <category scheme="http://blog.zhanghai.me/categories/design/" term="设计"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[你好，世界！]]></title>
    <link href="http://blog.zhanghai.me/hello-world/"/>
    <id>http://blog.zhanghai.me/hello-world/</id>
    <published>2014-10-31T05:45:52.000Z</published>
    <updated>2014-10-31T05:46:24.000Z</updated>
    <content type="html"><![CDATA[<p>你好，世界！</p>
]]></content>
  </entry>
</feed>
